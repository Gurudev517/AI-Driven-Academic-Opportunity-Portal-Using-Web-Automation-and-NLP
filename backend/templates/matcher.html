{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="resume-card" style="width: 600px; margin: 40px auto; text-align: center;">
        <h2>AI Resume Matcher</h2>
        <p style="color: #64748b; margin-bottom: 20px;">
            Upload your CV to find internships that match your specific skillset.
        </p>

        <div class="upload-box"
             style="border: 2px dashed #cbd5e1; padding: 40px; border-radius: 12px; position: relative; cursor: pointer;">
            <span style="font-size: 40px;">‚¨ÜÔ∏è</span>
            <p id="up-text">
                <b>Upload Resume (PDF)</b><br>
                <span style="font-size: 12px; color: #94a3b8;">Standard parsing active</span>
            </p>
            <input type="file" id="resume-input" accept=".pdf"
                   style="position:absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer;">
        </div>
    </div>

    <!-- TRUSTED INSTITUTES MARQUEE -->
<section class="institute-strip">
    <p class="strip-title">
        <strong>Opportunities from India‚Äôs premier institutes</strong>
    </p>

    <div class="logo-marquee">
        <div class="logo-track">
            <!-- Repeat logos twice for smooth infinite scroll -->
            <img src="/static/iit_bombay.webp" alt="IIT Bombay">
            <img src="/static/iit_delhi.webp" alt="IIT Delhi">
            <img src="/static/iit_madras.webp" alt="IIT Madras">
            <img src="/static/iit_kanpur.webp" alt="IIT Kanpur">
            <img src="/static/iit_kharagpur.webp" alt="IIT Kharagpur">

            <img src="/static/nit_trichy.webp" alt="NIT Trichy">
            <img src="/static/nit_warangal.webp" alt="NIT Warangal">
            <img src="/static/nit_surathkal.webp" alt="NIT Surathkal">
            <img src="/static/nit_calicut.webp" alt="NIT Calicut">

            <img src="/static/iiit_h.webp" alt="IIIT Hyderabad">
            <img src="/static/iiit_bangalore.webp" alt="IIIT Bangalore">
            <img src="/static/iiit_d.webp" alt="IIIT Delhi">
            <img src="/static/iiit_allahabad.jpg" alt="IIIT Allahabad">
            <img src="/static/iisc_bangalore.webp" alt="IISc Bangalore">

            <!-- DUPLICATE FOR LOOP -->
            <img src="/static/iit_bombay.webp">
            <img src="/static/iit_delhi.webp">
            <img src="/static/iit_madras.webp">
            <img src="/static/iit_kanpur.webp">
            <img src="/static/iit_kharagpur.webp">
        </div>
    </div>
</section>


    <!-- Why AI Matching -->
    <div class="filters-card"
         style="max-width: 800px; margin: 40px auto; padding: 30px; border-top: 4px solid #2563eb; background: #fff;">
        <div style="display: flex; gap: 30px; align-items: center; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 300px;">
                <h3 style="margin-top: 0; color: #0f172a; font-size: 20px;">ü§ñ Why use AI Matching?</h3>
                <p style="font-size: 14px; color: #64748b; line-height: 1.6;">
                    Traditional searching requires manual filtering. Our AI engine analyzes the
                    semantic context of your experience to find hidden opportunities.
                </p>

                <ul style="list-style: none; padding: 0; margin: 0; font-size: 13px; color: #334155;">
                    <li style="margin-bottom: 10px; display: flex;">
                        <span style="color:#2563eb; margin-right:10px;">‚ú¶</span>
                        <span><strong>Keyword Extraction:</strong> Automatically identifies tools and technologies.</span>
                    </li>
                    <li style="margin-bottom: 10px; display: flex;">
                        <span style="color:#2563eb; margin-right:10px;">‚ú¶</span>
                        <span><strong>Score Ranking:</strong> Compatibility score for each opening.</span>
                    </li>
                    <li style="display: flex;">
                        <span style="color:#2563eb; margin-right:10px;">‚ú¶</span>
                        <span><strong>Hidden Gems:</strong> Skill-based matches beyond job titles.</span>
                    </li>
                </ul>
            </div>

            <!-- Clean AI Illustration -->
            <div style="width: 220px; flex-shrink: 0; margin: 0 auto;">
                <img
                  src="https://github.com/srbhr/Resume-Matcher/raw/main/assets/header.png"
                  alt="AI Resume Matching"
                  style="width:100%; border-radius:12px;">
            </div>
        </div>
    </div>
</div>

<!-- Results -->
<section class="results" id="results-area"
         style="max-width: 800px; margin: 0 auto; padding-bottom: 100px;">
</section>

{% raw %}
<script>
document.getElementById('resume-input').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;

    document.getElementById('up-text').innerHTML =
        "<b>Analyzing:</b> " + file.name;

    const formData = new FormData();
    formData.append('resume', file);

    fetch('/match-resume', {
        method: 'POST',
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        const area = document.getElementById('results-area');
        area.innerHTML =
            `<h2 style="color:#2563eb; text-align:center; margin-bottom:30px;">
                Best Skill Matches
             </h2>`;

        if (!data.matches || data.matches.length === 0) {
            area.innerHTML +=
                `<p style="text-align:center;">No skill matches found.</p>`;
            return;
        }

        data.matches.forEach(item => {
            area.innerHTML += `
                <div class="result-card" style="border-left:4px solid #2563eb; margin-bottom:15px;">
                    <span class="type-badge" style="background:#2563eb; color:#fff;">
                        Match Score: ${item.match_score}
                    </span>
                    <h3 style="margin:10px 0;">${item.title}</h3>
                    <p style="color:#64748b; font-size:14px;">
                        üèõÔ∏è ${item.full_name} | üìç ${item.city_name}
                    </p>
                    <div style="display:flex; justify-content:space-between; margin-top:12px;">
                        <span style="font-size:13px;">
                            üìß ${item.email || 'contact@institute.ac.in'}
                        </span>
                        <a href="${item.link}" target="_blank"
                           style="color:#2563eb; font-weight:600; text-decoration:none;">
                           View Official PDF ‚Üí
                        </a>
                    </div>
                </div>`;
        });
    })
    .catch(err => {
        console.error(err);
        alert("Matching failed. Check server logs.");
    });
});
</script>
{% endraw %}
{% endblock %}
